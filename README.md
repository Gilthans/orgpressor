# orgpressor-ui

A React component library for interactive organization chart visualization. Built with vis-network.

## Features

- Drag-and-drop node reorganization
- Hierarchical layout with automatic positioning
- Detach nodes by dragging down past threshold
- Attach nodes by dropping onto other nodes
- Create root nodes by dropping in the top bar
- Double-click to edit node metadata (role, etc.)
- Subtree movement (children move with parent)

## Installation

### From npm registry (when published)

```bash
pnpm add orgpressor-ui
```

### From local .tgz file (air-gapped networks)

1. Build and pack the library:

```bash
cd apps/orgpressor-ui
pnpm build
pnpm pack
```

This creates `orgpressor-ui-0.0.1.tgz`.

2. Copy the .tgz file to your target machine and install:

```bash
pnpm add ./path/to/orgpressor-ui-0.0.1.tgz
```

## Peer Dependencies

This library requires React 18+:

```json
{
  "peerDependencies": {
    "react": "^18.0.0",
    "react-dom": "^18.0.0"
  }
}
```

## Usage

```tsx
import { OrgGraph } from 'orgpressor-ui';
import type { PersonNode, HierarchyEdge } from 'orgpressor-ui';

const nodes: PersonNode[] = [
    { id: '1', label: 'Alice Chen' },
    { id: '2', label: 'Bob Smith' },
    { id: '3', label: 'Carol Johnson' },
];

const edges: HierarchyEdge[] = [
    { from: '1', to: '2' },
    { from: '1', to: '3' },
];

function App() {
    return (
        <div style={{ width: '100%', height: '500px' }}>
            <OrgGraph nodes={nodes} edges={edges} />
        </div>
    );
}
```

## API

### OrgGraph

Main component for rendering the organization chart.

```tsx
interface OrgGraphProps {
    nodes: PersonNode[];
    edges: HierarchyEdge[];
}
```

### Types

```tsx
interface PersonNode {
    id: string;
    label: string;
}

interface HierarchyEdge {
    from: string;
    to: string;
    isAutoGenerated?: boolean; // If true, renders as dashed line
}

interface NodeMetadata {
    role?: string; // Displayed above the node label
}
```

## Development

```bash
# Start dev server
pnpm dev

# Run tests
pnpm test

# Run tests in watch mode
pnpm test:watch

# Build library
pnpm build

# Create distributable package
pnpm pack
```

## Demo

See `apps/demo` for a working example of consuming this library as an external dependency.

```bash
# From monorepo root
pnpm dev --filter demo
```

## Air-Gapped Deployment Guide

Complete workflow for deploying to an air-gapped network with Artifactory.

### Phase 1: Build the Package (on connected machine)

```bash
# Clone the repo and navigate to the library
git clone <repo-url>
cd orgpressor/apps/orgpressor-ui

# Install dependencies
pnpm install

# Build the library (creates dist/ folder)
pnpm build

# Create the distributable package
pnpm pack
```

This produces: `orgpressor-ui-0.0.1.tgz`

### Phase 2: Upload to Air-Gapped Network

Upload this single file to your air-gapped network:

```
orgpressor-ui-0.0.1.tgz
```

That's it - the .tgz contains everything needed:
- `dist/index.mjs` - ES module build
- `dist/index.cjs` - CommonJS build
- `dist/*.d.ts` - TypeScript declarations
- `package.json` - Package metadata

### Phase 3: Publish to Artifactory

On the air-gapped network, publish the package to your Artifactory npm registry:

```bash
# Option A: Using npm CLI
npm publish orgpressor-ui-0.0.1.tgz --registry https://your-artifactory.example.com/artifactory/api/npm/npm-local/

# Option B: Using curl (if npm isn't configured)
curl -u <username>:<password> \
  -X PUT \
  "https://your-artifactory.example.com/artifactory/api/npm/npm-local/orgpressor-ui/-/orgpressor-ui-0.0.1.tgz" \
  -T orgpressor-ui-0.0.1.tgz

# Option C: Via Artifactory Web UI
# 1. Navigate to: Artifactory > Artifacts > npm-local
# 2. Click "Deploy" button
# 3. Upload orgpressor-ui-0.0.1.tgz
# 4. Artifactory will automatically extract and index the package
```

### Phase 4: Configure pnpm to Use Artifactory

In your consuming project, configure the registry. Choose one method:

**Method A: Project-level .npmrc (recommended)**

Create or edit `.npmrc` in your project root:

```ini
registry=https://your-artifactory.example.com/artifactory/api/npm/npm-local/
//your-artifactory.example.com/artifactory/api/npm/npm-local/:_authToken=<your-token>
```

**Method B: Scoped registry (if using @org/package-name)**

```ini
@yourorg:registry=https://your-artifactory.example.com/artifactory/api/npm/npm-local/
```

### Phase 5: Install the Package

```bash
# Install from Artifactory registry
pnpm add orgpressor-ui

# Or specify version explicitly
pnpm add orgpressor-ui@0.0.1
```

This adds to your `package.json`:

```json
{
  "dependencies": {
    "orgpressor-ui": "^0.0.1"
  }
}
```

### Phase 6: Use in Your Code

```tsx
// Import the component and types
import { OrgGraph } from 'orgpressor-ui';
import type { PersonNode, HierarchyEdge, NodeMetadata } from 'orgpressor-ui';

// Define your data
const nodes: PersonNode[] = [
    { id: '1', label: 'Alice Chen' },
    { id: '2', label: 'Bob Smith' },
    { id: '3', label: 'Carol Johnson' },
];

const edges: HierarchyEdge[] = [
    { from: '1', to: '2' },
    { from: '1', to: '3' },
];

// Render the component (requires a sized container)
function OrgChartPage() {
    return (
        <div style={{ width: '100%', height: '600px' }}>
            <OrgGraph nodes={nodes} edges={edges} />
        </div>
    );
}
```

**Important:** The `OrgGraph` component requires a parent container with defined dimensions. It will fill 100% of its parent's width and height.

### Troubleshooting

**"React is not defined" or peer dependency errors:**
```bash
# Ensure React 18+ is installed in your project
pnpm add react react-dom
```

**TypeScript can't find types:**
```bash
# Ensure TypeScript is configured for node module resolution
# In tsconfig.json:
{
  "compilerOptions": {
    "moduleResolution": "bundler"  // or "node"
  }
}
```

**Package not found in Artifactory:**
```bash
# Verify the package exists
npm view orgpressor-ui --registry https://your-artifactory.example.com/artifactory/api/npm/npm-local/

# Check Artifactory indexing (may take a minute after upload)
```
