# Orgpressor UI - Implementation Details

See `../../CLAUDE.md` for project overview and core concepts.

## Commands

```bash
pnpm dev          # Start dev server (port 5173)
pnpm build        # TypeScript + Vite build
pnpm test         # Vitest unit tests
pnpm test:e2e     # Playwright e2e tests
pnpm test:e2e:ui  # Playwright with UI
```

## Architecture

### Types (`src/types.ts`)
- `VisNode` - vis-network node with `isRoot?` flag
- `VisEdge` - vis-network edge with `dashes?`, `title?` for auto-generated styling
- `SubtreeContext` - Captures node + descendants with relative positions
- `DragState` - Tracks drag operation state

### Constants (`src/config.ts`)
- `SNAP_OUT_THRESHOLD = 150` - Pixels to drag before disconnecting
- `RUBBER_BAND_FACTOR = 0.15` - Resistance for connected nodes
- `TOP_BAR_HEIGHT = 60` - Root drop zone height

### Hooks
- `useVisNetwork` - Initializes vis-network
- `useLayout` - Positions roots in top bar, free nodes below
- `useNodeDrag` - Drag behavior (rubber band → snap-out → drop)
- `useViewConstraints` - Pan/zoom limits

### Utilities
- `hierarchy.ts` - Node relationships (`isNodeFree` checks parent edge only)
- `subtree.ts` - `captureSubtree`, `createSubtreeMoveUpdates`
- `positions.ts` - Position calculations
- `network.ts` - Canvas/DOM coordinate conversion

## Key Behaviors

**Subtree movement**: All drag operations move entire subtrees. `createSubtreeMoveUpdates()` is the core function.

**Edge styling**: `isAutoGenerated: true` → dashed + tooltip. User-created → solid.

**isNodeFree**: A node is "free" if it has no parent edge. Having children doesn't make it connected.

## Test Data

Nodes 1-7 in hierarchy (John→Sarah,Michael→...), nodes 8-12 free. All initial edges auto-generated.

## E2E Tests

Playwright at 1280x720. Key positions:
- Root (John): x≈370, y≈30
- Level 1 (Sarah/Michael): y≈130
- Level 2: y≈230
- Free nodes: y≈407, x starting ≈620

Tests use canvas screenshot comparison for verification.
